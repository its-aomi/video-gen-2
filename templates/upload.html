<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Slideshow Creator</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1 class="mb-4">Video Slideshow Creator</h1>
        <div id="errorAlert" class="alert alert-danger" role="alert" style="display: none;"></div>
        <form id="uploadForm" method="post" enctype="multipart/form-data">
            <div class="mb-3">
                <label for="files" class="form-label">Choose images to upload</label>
                <input type="file" class="form-control" id="files" name="files[]" accept=".png,.jpg,.jpeg,.gif" multiple>
            </div>
            <button type="submit" class="btn btn-primary">Upload and Create Slideshow</button>
        </form>
        <div class="progress mt-4">
            <div id="progressBar" class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">0%</div>
        </div>
        <div id="taskText" class="mt-2">Waiting to upload...</div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
    <script>
        var socket = io();

        socket.on('connect', function() {
            console.log('Connected to server');
        });

        socket.on('progress', function(data) {
            var progressBar = document.getElementById('progressBar');
            var progress = data.progress;
            var task = data.task;
            progressBar.style.width = progress + '%';
            progressBar.setAttribute('aria-valuenow', progress);
            progressBar.textContent = Math.round(progress) + '%';
            document.getElementById('taskText').textContent = task;
        });

        document.getElementById('uploadForm').addEventListener('submit', function(event) {
            event.preventDefault();
            var formData = new FormData(this);
            var xhr = new XMLHttpRequest();

            xhr.open('POST', '/', true);

            xhr.upload.onprogress = function(event) {
                if (event.lengthComputable) {
                    var percentComplete = (event.loaded / event.total) * 100;
                    var progressBar = document.getElementById('progressBar');
                    progressBar.style.width = percentComplete + '%';
                    progressBar.setAttribute('aria-valuenow', percentComplete);
                    progressBar.textContent = Math.round(percentComplete) + '%';
                    document.getElementById('taskText').textContent = 'Uploading';
                }
            };

            xhr.onload = function() {
                var errorAlert = document.getElementById('errorAlert');
                if (xhr.status === 200 || xhr.status === 202) {
                    // File(s) uploaded successfully, reset progress bar
                    errorAlert.style.display = 'none';
                    document.getElementById('progressBar').style.width = '0%';
                    document.getElementById('progressBar').textContent = '0%';
                } else {
                    // Handle error
                    var response = JSON.parse(xhr.responseText);
                    errorAlert.textContent = response.error;
                    errorAlert.style.display = 'block';
                }
            };

            xhr.send(formData);
        });
    </script>
</body>
</html>
